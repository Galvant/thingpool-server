<!DOCTYPE html>
<html>
    <head>
        <title>
            {{ pool_name }} Admin Console
        </title>
        
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        
        <script type="text/javascript">
            function resolve(id, resolution) {
                console.log(id);
                $("#user_id").val(id);
                $("#request_resolution").val(resolution);
                
                $("#pending_requests").submit();
                return false;
            };
            
            function populate_modify_fields(id, user_name, user_email, user_permissions, user_keycard) {
                console.log(id);
                document.getElementById('user_name').value = user_name;
                document.getElementById('user_email').value = user_email;
                document.getElementById('modify_id').value = id;
                document.getElementById('modify_keycard').value = user_keycard;
                
                switch(user_permissions) {
                    case -1: // User is banned
                        document.getElementById('radio_banned').checked = true;
                        document.getElementById('modify_permissions').value = -1;
                        break;
                    case 2: // User is a regular user
                        document.getElementById('radio_user').checked = true;
                        document.getElementById('modify_permissions').value = 2;
                        break;
                    case 3: // User is actually a kiosk account
                        document.getElementById('radio_kiosk').checked = true;
                        document.getElementById('modify_permissions').value = 3;
                        break;
                    case 4: // User is a manager
                        document.getElementById('radio_manager').checked = true;
                        document.getElementById('modify_permissions').value = 4;
                        break;
                }
                
                return false;
            };
            
            function submit_modify_user() {
                //console.log(id);
                var user_id = document.getElementById('modify_id').value;
                var user_permissions = 2;
                var user_keycard = document.getElementById('modify_keycard').value;
                
                if (document.getElementById('radio_banned').checked == true) {
                    user_permissions = -1;
                }
                else if (document.getElementById('radio_user').checked == true) {
                    user_permissions = 2;
                }
                else if (document.getElementById('radio_kiosk').checked == true) {
                    user_permissions = 3;
                }
                else if (document.getElementById('radio_manager').checked == true) {
                    user_permissions = 4;
                }
                
                console.log(user_id);
                console.log(user_permissions);
                console.log(user_keycard);
                
                $.post(
                    "{{ uri_for('api_users_list') }}/" + user_id, // POST target of /api/users/{id}
                    
                    { permissions: user_permissions } // data to send to server
                    
                )
            };
        </script>
    </head>
    
    <body>
    
        {% if not message is none %}
            {{ message }}
            <hr></hr>
        {% endif %}
    
        <h1>{{ pool_name }} Admin Console</h1>
        
        <h2>Pending Requests</h2>
        <form id="pending_requests" action="{{ uri_for('admin_main') }}" method="post">
            <input type="hidden" name="action" id="action" value="handle_account_request"></input>
            <input type="hidden" name="user_id" id="user_id" value="None"></input>
            <input type="hidden" name="request_resolution" id="request_resolution" value="None"></input>
            <ul>  
                {% for pending_user in pending_requests %}
                    <li>
                        {{ pending_user.user_account.nickname() }} &lt;{{ pending_user.user_account.email() }}&gt;
                        <a href="#" onclick="resolve({{ pending_user.key().id() }}, 'approve');">Approve</a>
                        <a href="#" onclick="resolve({{ pending_user.key().id() }}, 'deny');">Deny</a>
                    </li>
                {% endfor %}
            </ul>
        </form>
        
        <h2>Modify User</h2>
        <ul>
            <form id="modify_user" action="{{ uri_for('admin_main') }}" method="post">
                <input type="hidden" name="modify_permissions" id="modify_permissions" value="None">
                <input type="hidden" name="modify_id" id="modify_id" value="None">
                <input type="hidden" name="modify_keycard" id="modify_keycard" value="None">
            
                <label for="user_name">Name</label>
                <input type="text" name="user_name" id="user_name" value="Name" disabled="true"><br>
                <label for="user_email">Email</label>
                <input type="text" name="user_email" id="user_email" value="Email" disabled="true"><br>
                <label for="user_keycard">Keycard</label>
                <input type="text" name="user_keycard" id="user_keycard"><br><br>
                
                User Permissions<br>
                <input type="radio" name="user_status" id="radio_banned">
                <label for="radio_banned">Banned</label><br>
                
                <input type="radio" name="user_status" id="radio_user">
                <label for="radio_user">User</label><br>
                
                <input type="radio" name="user_status" id="radio_kiosk">
                <label for="radio_kiosk">Kiosk</label><br>
                
                <input type="radio" name="user_status" id="radio_manager">
                <label for="radio_manager">Manager</label><br><br>
                
                <a href="#" onclick="submit_modify_user( );">Submit</a>
                
                
            </form>
            <br>
            {% for user in all_users %}
                <li>
                    {{ user.user_account.nickname() }} &lt;{{ user.user_account.email() }}&gt;
                    <a href="#" onclick="populate_modify_fields( {{ user.key().id() }},
                                                                '{{ user.user_account.nickname() }}',
                                                                '{{ user.user_account.email() }}',
                                                                {{ user.permissions }},
                                                                '{{ user.keycard }}' );">Modify</a>
                </li>
            {% endfor %}
        </ul>
    </body>
</html>
